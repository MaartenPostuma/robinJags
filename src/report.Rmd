---
title: "jags report"
#code-author: MaartenPostuma
#date: 23-07-2019
output:
  html_document:
  df_print: paged
params:
  rmd: "report.Rmd"   
  args: myargs

#### author: `r system("whoami",inter=T)`
#### date: `r system("date",intern=T)`
---
  
```{r setup, include=FALSE}

#This is the setup. 
#It includes all the packages that are necessary and installs them if they are not yet there.
args <- commandArgs(TRUE)
library(ggplot2)
library(R2jags)
library(rjags)
library(DT)
knitr::opts_chunk$set(echo = FALSE)
knitr::opts_chunk$set(dev="png")
options(tinytex.verbose = TRUE)
knitr::opts_knit$set(root.dir = '../')

```

# Filter Steps {.tabset .tabset-fade .tabset-pills}

This file contains all of the traceplots of the jags analysis.
```{r,message=FALSE,results='asis',error=TRUE}
parameters<-read.table("variablesToTest.tsv",h=T)
outList<-list()
for(i in 1:nrow(parameters)){
  dataSub<-parameters[i,]
  modelOut <- readRDS(paste0(params$args[1],"output/Order~",dataSub$Order,"/Variable~",dataSub$Variable,".Rds"))
  summaryOut <- as.data.frame(modelOut$BUGSoutput$summary)
  summaryOut$sign<-""
  summaryOut$sign[(summaryOut$`2.5%`>0&summaryOut$`97.5%`>0)|(summaryOut$`2.5%`<0&summaryOut$`97.5%`<0)]<-"*"
  dataOut<-as.data.frame(t(data.frame(summaryOut[27:32,1])))
  dataOut[1:5]<-paste0(summaryOut[27:31,1],summaryOut$sign[27:31])
  colnames(dataOut)<-c("hedgerow","flowerstrip","JulianDay","JulianDay2","temperature","value")
  if((summaryOut$`2.5%`[32]>0&summaryOut$`97.5%`[32]>0)|(summaryOut$`2.5%`[32]<0&summaryOut$`97.5%`[32]<0)){
  dataOut$signVar<-"significant"}else{dataOut$signVar<-"no"}
  dataOut$Variable<-dataSub$Variable
  dataOut$Order<-dataSub$Order
  dataOut$lowSign<-summaryOut$`2.5%`[31]
  dataOut$highSign<-summaryOut$`97.5%`[31]
  row.names(dataOut)<-paste(dataSub$Order,dataSub$Variable)
  outList[[dataSub$Order]][[dataSub$Variable]]<-dataOut
  }

oneBigTable<-do.call(rbind,do.call(rbind,outList))


datatable(oneBigTable[c("Order","Variable","signVar","value","hedgerow","flowerstrip","JulianDay","JulianDay2","temperature")],filter="top")

write.csv(paste0(args[1],"/output/largeTable.csv"),row.names=F)
```


```{r,message=FALSE,results='asis',error=TRUE, fig.cap=paste(""),fig.dim=c(4,4),dpi=36}

#Big thing that makes all the analysis 
parameters<-read.table("variablesToTest.tsv",h=T)

for(order in unique(parameters$Order)){
  cat(paste0("\n\n## Order =",order,"{.tabset .tabset-fade .tabset-pills}"))
  
  
  for(variable in unique(parameters$Variable)){

  cat(paste0("\n\n### variable =", variable, "{.tabset .tabset-fade .tabset-pills}\n"))
  jagsModel<-readRDS(paste0(params$args[1],"output/Order~",order,"/Variable~",variable,".Rds"))
  cat(paste0("\n\n#### betas {.tabset .tabset-fade .tabset-pills}\n"))
  par(mfrow=c(3,3))
  print(traceplot(jagsModel,varname=c("tauSite","betaT","betaJ1","betaJ2","betaE", "betaVar")))
 #  cat(paste0("\n\n#### alphas {.tabset .tabset-fade .tabset-pills}\n"))
 # print(traceplot(jagsModel,varname=c("alpha","alphaSite")))

}
}
